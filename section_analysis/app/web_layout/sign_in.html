<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
    integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
  <link rel="stylesheet" href="/web_layout/css/style.css">
  <title>Stresstable</title>
</head>

<body>
  <div class="whole-page">
    <div class="not-footer">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark"><a class="navbar-brand" href="/">Stresstable</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
          aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"><span
            class="navbar-toggler-icon"></span></button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item active"><a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item"><a class="nav-link" href="/sections">Section analysis</a></li>
            <li class="nav-item"><a class="nav-link" href="#">Beam analysis</a></li>
            <li class="nav-item"><a class="nav-link" href="#">Contacts</a></li>
            <li class="nav-item"><a class="nav-link" href="/web_layout/sign_up.html">Sign Up</a></li>
            <li class="nav-item"><a class="nav-link" href="/web_layout/sign_in.html">Sign In</a></li>
            <li class="nav-item"><a id="current_user" class="nav-link" href="#"></a></li>
          </ul>
        </div>
      </nav>
      <h2>Authenticalion</h2>
      <div>
        <input id="username" placeholder="username">
        <input id="password" placeholder="password">
      </div>
      <button id="submit_button">submit</button>

      <p id="response_text"></p>
    </div>
    <div class="footer">
      <p class="text-justify">&copy 2020 Stresstable tools. All rights reserved</p>
    </div>
  </div>

  <script src="/web_layout/js/signup_and_signin_guest.js"></script>
  <script src="/web_layout/js/signin_user.js">
    /* const username = document.getElementById("username");
    const password = document.getElementById("password");
    const button = document.getElementById("submit_button");
    const response_text = document.getElementById("response_text");

    button.addEventListener("click", function () {
      const user_data = new FormData();
      user_data.append("username", username.value);
      user_data.append("password", password.value);

      if (username.value == null || username.value == "") {
        alert("Please Fill All Required Field");
        return false;
      }

      if (password.value == null || password.value == "") {
        alert("Please Fill All Required Field");
        return false;
      }

      signin_user(user_data);
    });


    function signin_user(user_data) {
      const url = "/auth/token";
      const my_settings = {
        method: 'POST',
        body: user_data
      };
      fetch(url, my_settings)
        .then(function (response) {
          if (response.ok) {
            return response.text()
              .then(function (text) {
                localStorage.setItem("Authorization", "Bearer " + JSON.parse(text)["access_token"]);
                const my_headers = new Headers();
                my_headers.append("Authorization", "Bearer " + JSON.parse(text)["access_token"]);
                const url = "/users/sign_in";
                const my_settings = {
                  method: "GET",
                  headers: my_headers,
                };
                fetch(url, my_settings)
                  .then(function (response) {
                    return response.text();
                  })
                  .then(function (text) {
                    document.body.innerHTML = text;
                  });
              });
          }
          else {
            return response.json()
              .then(function (json) {
                // throw Error(json["detail"]);
                response_text.textContent = json["detail"];
              });
          }
        });
    };


    function check(user_data) {
      for (elem in user_data) {
        if (user_data[elem] == null || user_data[elem] == "") {
          alert("Please Fill All Required Field");
          return false;
        }
      }
      return true;
    } */




    /*
    function showUser()
    {
      const my_headers = new Headers();
      my_headers.append("Authorization", localStorage.getItem("Authorization"));
      const url = "/users/me";
      const my_settings = {
        method: "GET",
        headers: my_headers,
      };
      fetch(url, my_settings)
      .then(function(response)
      {
        return response.text();
      })
      .then(function(text)
      {
        document.body.innerHTML = text;
      });
    };

    */

    /* const show_user = document.getElementById("show_user");
    show_user.addEventListener("click", function()
    {
      const my_headers = new Headers();
      my_headers.append("Authorization", localStorage.getItem("Authorization"));
      const url = "/users/me";
      const my_settings = {
        method: "GET",
        headers: my_headers,
      };
      fetch(url, my_settings)
      .then((response) => {
        return response.text();
      })
      .then((html) => {
        document.body.innerHTML = html
      });
    }); */

  </script>
</body>

</html>